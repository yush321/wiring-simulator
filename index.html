<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <title>전기기능사 마스터 (최종)</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
            background-color: #333; color: white;
            display: flex; flex-direction: column; align-items: center;
            padding: 10px; margin: 0; overscroll-behavior: none; user-select: none;
        }
        h2 { margin: 10px 0; font-size: 1.2rem; text-align: center; color: #fff; }
        
        .controls { 
            margin-bottom: 10px; padding: 10px; background: #444;
            border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.3);
            display: flex; flex-wrap: wrap; gap: 10px; justify-content: center; align-items: center;
        }
        select { padding: 8px; font-weight: bold; border-radius: 4px; border: none; }
        button { 
            padding: 8px 15px; cursor: pointer; border: none; border-radius: 4px; 
            font-weight: bold; font-size: 14px; color: white; transition: 0.2s;
        }
        button:hover { filter: brightness(1.2); }
        .btn-reset { background-color: #6c757d; }
        .btn-check { background-color: #28a745; }
        .btn-undo { background-color: #ffc107; color: black; }
        .btn-check.active { background-color: #dc3545; }
        .btn-info { background-color: #17a2b8; }
        .btn-numbering { background-color: #6f42c1; }
        .btn-numbering.active { background-color: #c823e0; }
        .btn-admin { background-color: #007bff; border: 1px solid #0056b3; }
        .btn-delete-all { background-color: #dc3545; border: 1px solid #a71d2a; font-size: 12px;}

        /* 모달 스타일 */
        /* 팝업창 영역에서 두 손가락 확대(Pinch Zoom) 허용 */
        #infoModal, .modal-content {
            touch-action: pinch-zoom manipulation !important;
        }

        /* 실제 배선 작업이 이루어지는 캔버스/작업 영역은 
        한 손가락은 '조작', 두 손가락은 '확대'로 분리 */
        #simulation-container {
            touch-action: none; /* 여기는 배선 조작을 위해 브라우저 제스처 차단 */
        }
        .modal-overlay {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); z-index: 1000; justify-content: center; align-items: center;
        }
        .modal-content {
            background: #fff; color: #333; width: 90%; max-width: 500px;
            padding: 25px; border-radius: 12px; position: relative;
            max-height: 85vh; overflow-y: auto; text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.5);
        }
        .modal-header { font-size: 20px; font-weight: bold; margin-bottom: 15px; border-bottom: 2px solid #333; padding-bottom: 10px; }
        .modal-body img { max-width: 100%; height: auto; border: 1px solid #ccc; margin: 10px 0; border-radius: 5px;}
        .close-btn { position: absolute; top: 10px; right: 15px; font-size: 28px; cursor: pointer; font-weight: bold; color: #666; }
        .success-icon { font-size: 50px; margin-bottom: 10px; display: block; }

        #adminInfo { display: none; width: 90%; max-width: 700px; background: #222; border: 1px solid #555; padding: 15px; border-radius: 8px; margin-bottom: 10px; font-size: 14px; line-height: 1.6; }
        .info-header { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #444; padding-bottom: 10px; margin-bottom: 10px; }
        .component-filter-panel {
            margin-top: 8px;
            border: 1px solid #3b475c;
            border-radius: 8px;
            background: #1a2230;
            padding: 8px;
        }
        .component-filter-list {
            max-height: 180px;
            overflow-y: auto;
            border: 1px solid #334155;
            border-radius: 6px;
            padding: 8px;
            margin-top: 6px;
            background: #0f172a;
        }
        .component-filter-item {
            display: flex;
            align-items: center;
            gap: 6px;
            margin: 3px 0;
            color: #dbeafe;
            font-size: 12px;
        }
        .key-badge { background: #555; padding: 2px 8px; border-radius: 4px; font-weight: bold; color: #fff; border: 1px solid #777; font-family: monospace; font-size: 16px; margin-right: 5px;}
        .mode-desc { display: flex; align-items: center; margin-bottom: 8px; }
        input[type="number"] { width: 50px; padding: 4px; text-align: center; background: #333; color: white; border: 1px solid #666; font-weight: bold; }
        #exportArea { width: 100%; height: 80px; margin-top: 10px; font-family: monospace; font-size: 12px; display: none; background: #111; color: #0f0; border: 1px solid #444; }

        canvas {
            background-color: #e8cfaa;
            background-image: url('./images/backgrd-optimized.jpg');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            border: 2px solid #a48562;
            box-shadow:
                inset 0 0 0 1px rgba(255, 255, 255, 0.3),
                0 0 10px rgba(0, 0, 0, 0.2);
            touch-action: none;
            max-width: 100%;
            height: auto;
        }
        .legend { font-size: 12px; color: #ccc; margin-top: 8px; display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;}
        .dot { width: 10px; height: 10px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        #statusMsg { font-weight: bold; color: #fff; font-size: 14px; margin-left: 10px; }
    /* 모달 하단 버튼 영역 */
    .modal-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 15px;
        gap: 10px;
    }
    .btn-page {
        flex: 1;
        background: #6c757d;
        color: white;
        padding: 10px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-weight: bold;
    }
    .btn-page:disabled { background: #ccc; cursor: not-allowed; }
    .btn-start { background: #007bff; }
    .btn-play { background: #fd7e14; }
    #pageIndicator { font-size: 14px; font-weight: bold; color: #666; }
    
        /* 튜토리얼 팝업 내 버튼 스타일 */
    .modal-footer button {
        padding: 10px 20px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        border: none;
        border-radius: 5px;
        transition: background 0.3s;
        margin: 0 5px;
    }

    /* [이전] 버튼: 조금 더 선명한 회색 계열 */
    #prevBtn {
        background-color: #6c757d;
        color: white;
    }
    #prevBtn:hover {
        background-color: #5a6268;
    }

    /* [다음] 버튼: 신뢰감을 주는 파란색 (가장 잘 보임) */
    #nextBtn {
        background-color: #007bff;
        color: white;
    }
    #nextBtn:hover {
        background-color: #0069d9;
    }

    /* [실습 시작] 버튼: 긍정적인 초록색 */
    #startBtn {
        background-color: #28a745;
        color: white;
    }
    #startBtn:hover {
        background-color: #218838;
    }

    /* 버튼이 비활성화(disabled) 되었을 때 스타일 */
    button:disabled {
        background-color: #e9ecef !important;
        color: #adb5bd !important;
        cursor: not-allowed;
    }

    /* 페이지 표시 숫자 (1/2) 스타일 */
    #pageIndicator {
        font-weight: bold;
        margin: 0 15px;
        color: #333;
    }
        .numbering-guide { text-align: left; margin: 4px 0 8px; color: #333; font-size: 14px; line-height: 1.5; }
        .numbering-guide.below-image {
            margin-top: 10px;
            padding: 8px 10px;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            background: #ffffff;
        }
        .numbering-stage { text-align: left; margin: 4px 0; color: #111; font-size: 14px; font-weight: 700; }
        .numbering-progress { height: 10px; background: #e9ecef; border-radius: 999px; overflow: hidden; margin-top: 6px; }
        .numbering-progress-fill { height: 100%; width: 0%; background: linear-gradient(90deg, #6f42c1, #17a2b8); transition: width 0.25s ease; }
        .numbering-progress-text { text-align: left; margin-top: 6px; color: #555; font-size: 12px; }
        .numbering-image-wrap { margin-top: 10px; }
        .numbering-image-wrap img { width: 100%; border: 1px solid #ddd; border-radius: 8px; }
        .numbering-question { display: none; margin-top: 10px; text-align: left; font-size: 14px; font-weight: 700; color: #222; }
        .numbering-component-mock {
            margin-top: 10px;
            border: 1px solid #d0d7de;
            border-radius: 10px;
            padding: 10px;
            background: #f8fafc;
        }
        .numbering-component-title {
            font-size: 13px;
            font-weight: 700;
            color: #334155;
            margin-bottom: 8px;
            text-align: left;
        }
        .numbering-mock-body {
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            background: #ffffff;
            padding: 8px;
        }
        .numbering-mock-row-label {
            font-size: 11px;
            color: #64748b;
            font-weight: 700;
            margin: 6px 0 4px;
            text-align: left;
        }
        .numbering-pin-row {
            display: grid;
            gap: 6px;
            margin-bottom: 4px;
        }
        .numbering-pin-row:last-child { margin-bottom: 0; }
        .numbering-pin-row.cols-2 { grid-template-columns: repeat(2, minmax(0, 1fr)); }
        .numbering-pin-row.cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
        .numbering-pin-row.cols-4 { grid-template-columns: repeat(4, minmax(0, 1fr)); }
        .numbering-pin-row.cols-5 { grid-template-columns: repeat(5, minmax(0, 1fr)); }
        .numbering-pin-row.cols-6 { grid-template-columns: repeat(6, minmax(0, 1fr)); }
        .numbering-pin-row.cols-8 { grid-template-columns: repeat(8, minmax(0, 1fr)); }
        .numbering-pin-row.cols-10 { grid-template-columns: repeat(10, minmax(0, 1fr)); }
        .numbering-pin-slot-empty {
            border: 1px dashed #e2e8f0;
            border-radius: 8px;
            min-height: 42px;
            background: #f8fafc;
        }
        .numbering-pin-btn {
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            background: white;
            padding: 8px 6px;
            font-weight: 700;
            color: #111827;
            line-height: 1.2;
            min-height: 42px;
        }
        .numbering-pin-btn small {
            display: block;
            margin-top: 4px;
            font-size: 11px;
            color: #64748b;
            font-weight: 600;
        }
        .numbering-pin-btn:hover {
            background: #dbeafe;
            border-color: #60a5fa;
            color: #0f172a;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.2);
        }
        .numbering-pin-btn.selected {
            border-color: #198754;
            background: #e9f7ef;
            color: #14532d;
        }
        .numbering-pin-btn.reverse {
            border-color: #fd7e14;
            background: #fff4e6;
            color: #9a3412;
        }
        .numbering-choices { display: grid; grid-template-columns: repeat(3, minmax(0, 1fr)); gap: 8px; margin-top: 10px; }
        .numbering-choice { background: #f8f9fa; border: 1px solid #ced4da; color: #111; border-radius: 8px; padding: 10px; font-weight: 700; }
        .numbering-choice:hover { background: #eef2ff; }
        #numberingResult { margin-top: 10px; font-weight: bold; color: #333; text-align: left; }
        .numbering-focus-wrap {
            position: relative;
            margin-top: 10px;
            border-radius: 8px;
            overflow: hidden;
        }
        #numberingFocusRect {
            position: absolute;
            border: 2px solid #ff4757;
            background: rgba(255, 71, 87, 0.18);
            display: none;
            pointer-events: none;
        }
        #numberingAnswerOverlay {
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 3;
        }
        .numbering-overlay-tag {
            position: absolute;
            transform: translate(-50%, -50%);
            background: rgba(0, 123, 255, 0.9);
            color: #fff;
            border-radius: 999px;
            padding: 2px 8px;
            font-size: 11px;
            font-weight: 700;
            white-space: nowrap;
        }
        .numbering-overlay-tag.reverse {
            background: rgba(253, 126, 20, 0.95);
        }
        .numbering-overlay-tag.question {
            width: 16px;
            height: 16px;
            padding: 0;
            border-radius: 50%;
            line-height: 16px;
            background: rgba(13, 110, 253, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.8);
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.2);
            opacity: 0.8;
            text-align: center;
            font-size: 10px;
        }
        #numberingReverseState {
            margin-top: 6px;
            text-align: left;
            font-size: 12px;
            color: #fd7e14;
            font-weight: 700;
            min-height: 16px;
        }
        .numbering-input-wrap { display: none; gap: 8px; margin-top: 10px; }
        .numbering-input-wrap input {
            flex: 1;
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 10px;
            font-weight: 700;
        }
        .numbering-editor-canvas-wrap {
            position: relative;
            margin-top: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            touch-action: none;
            user-select: none;
            -webkit-user-select: none;
        }
        .numbering-editor-canvas-wrap img {
            width: 100%;
            display: block;
            user-select: none;
            -webkit-user-drag: none;
            pointer-events: none;
        }
        #numberingEditorRect {
            position: absolute;
            border: 2px dashed #0d6efd;
            background: rgba(13, 110, 253, 0.18);
            display: none;
            pointer-events: none;
        }
        .editor-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px; }
        .editor-grid input, .editor-grid textarea, .editor-grid select {
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 8px;
            font-size: 13px;
        }
        .editor-warning {
            grid-column: 1 / -1;
            text-align: left;
            color: #dc3545;
            font-size: 12px;
            font-weight: 700;
            min-height: 18px;
        }
        .editor-wide { grid-column: 1 / -1; }
        .editor-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-top: 10px; }
        .tutorial-editor-toolbar {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        .tutorial-editor-toolbar button {
            background: #334155;
            font-size: 12px;
            padding: 6px 10px;
        }
        .tutorial-page-item {
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 10px;
            background: #f8fafc;
            margin-top: 8px;
        }
        .tutorial-page-item h4 {
            margin: 0 0 6px;
            text-align: left;
            color: #1e293b;
            font-size: 13px;
        }
        .tutorial-page-item textarea {
            width: 100%;
            min-height: 110px;
            border: 1px solid #ced4da;
            border-radius: 8px;
            padding: 8px;
            box-sizing: border-box;
            font-size: 13px;
            font-family: 'Malgun Gothic', sans-serif;
        }
        .tutorial-editor-status {
            margin-top: 8px;
            min-height: 18px;
            color: #0f766e;
            text-align: left;
            font-size: 12px;
            font-weight: 700;
        }
        .tutorial-page-tabs {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        .tutorial-page-tab {
            border: 1px solid #cbd5e1;
            background: #e2e8f0;
            color: #1e293b;
            border-radius: 999px;
            padding: 4px 10px;
            font-size: 12px;
            font-weight: 700;
            cursor: pointer;
        }
        .tutorial-page-tab.active {
            background: #0d6efd;
            border-color: #0d6efd;
            color: #fff;
        }
        .tutorial-preview-box {
            min-height: 90px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            background: #fff;
            padding: 10px;
            text-align: left;
            color: #111;
            line-height: 1.5;
        }
        #playbackControls {
            display: none;
            margin-top: 8px;
            padding: 8px;
            border: 1px solid #4b5563;
            border-radius: 8px;
            background: #1f2937;
            color: #e5e7eb;
            width: 90%;
            max-width: 700px;
        }
        #playbackControls .row {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center;
        }
        #playbackControls .row button {
            background: #374151;
            border: 1px solid #4b5563;
            padding: 6px 10px;
            font-size: 12px;
        }
</style>
</head>
<body>

    <div id="infoModal" class="modal-overlay">
        <div class="modal-content">
            <span class="close-btn" onclick="closeModal('infoModal')">&times;</span>
            <div class="modal-header" id="modalTitle">학습 안내</div>
            <div id="modalBody" class="modal-body"></div>
            
            <div class="modal-footer">
                <div style="display:flex; gap:6px; align-items:center; flex:1;">
                    <button id="playBtn" class="btn-page btn-play" onclick="playTutorialFlowFromModal()">재생</button>
                    <select id="playSpeedSelect" style="padding:8px; border-radius:5px; border:1px solid #ced4da; font-weight:700;">
                        <option value="800">느림</option>
                        <option value="550" selected>보통</option>
                        <option value="300">빠름</option>
                    </select>
                </div>
                <button id="prevBtn" onclick="changePage(-1)">이전</button>
                <span id="pageIndicator">1 / 1</span>
                <button id="nextBtn" onclick="changePage(1)">다음</button>
                <button id="startBtn" class="btn-page btn-start" onclick="closeModal('infoModal')" style="display:none;">실습 시작</button>
            </div>
        </div>
    </div>

    <div id="successModal" class="modal-overlay">
        <div class="modal-content" style="border-top: 5px solid #28a745;">
            <span class="close-btn" onclick="closeModal('successModal')">&times;</span>
            <div class="modal-body">
                <span class="success-icon">🎉</span>
                <h2 style="color:#28a745; margin:0;">정답입니다!</h2>
                <p style="margin-top:10px; font-size:16px;">완벽하게 결선하셨습니다.</p>
            </div>
            <button style="width:100%; margin-top:15px; background:#28a745; color:white; padding:12px; border:none; border-radius:5px; cursor:pointer; font-weight:bold; font-size:16px;" onclick="continueAfterSuccess()">다음 실습</button>
        </div>
    </div>

    <div id="numberingModal" class="modal-overlay">
        <div class="modal-content" style="max-width:620px;">
            <span class="close-btn" onclick="closeNumberingModal()">&times;</span>
            <div class="modal-header">넘버링 (핀 번호 선택)</div>
            <div id="numberingStageInfo" class="numbering-stage">단계 준비 중</div>
            <div class="numbering-progress"><div id="numberingProgressFill" class="numbering-progress-fill"></div></div>
            <div id="numberingProgressText" class="numbering-progress-text">진행률 0% (0/0)</div>
            <div class="numbering-focus-wrap">
                <div class="numbering-image-wrap"><img id="numberingImage" src="./images/images1.png" alt="넘버링 참고" draggable="false"></div>
                <div id="numberingFocusRect"></div>
                <div id="numberingAnswerOverlay"></div>
            </div>
            <p id="numberingGuideText" class="numbering-guide below-image">넘버링은 회로도에서 현재 부품의 핀 번호를 맞추는 훈련입니다.</p>
            <div id="numberingQuestion" class="numbering-question">문제를 불러오는 중입니다.</div>
            <div id="numberingReverseState"></div>
            <div id="numberingComponentMock" class="numbering-component-mock" style="display:none;"></div>
            <div id="numberingChoices" class="numbering-choices"></div>
            <div id="numberingInputWrap" class="numbering-input-wrap">
                <input id="numberingAnswerInput" type="text" placeholder="핀 번호 입력 (예: 8, 12, +1)">
                <button style="background:#0d6efd;" onclick="submitNumberingInput()">정답 확인</button>
            </div>
            <div id="numberingList" style="display:none;"></div>
            <div id="numberingResult">정답을 고르면 자동으로 다음 문제로 이동합니다.</div>
            <div style="display:flex; gap:8px; margin-top:12px;">
                <button style="flex:1; background:#6f42c1;" onclick="gradeNumberingAnswers()">진행률 확인</button>
                <button style="flex:1; background:#17a2b8;" onclick="fillCorrectNumbers()">정답보기</button>
                <button style="flex:1; background:#fd7e14;" onclick="resetCurrentNumberingStage()">다시 입력</button>
                <button style="flex:1; background:#495057;" onclick="prevNumberingStage()">이전 단계</button>
                <button style="flex:1; background:#0d6efd;" onclick="nextNumberingStage()">다음 단계</button>
                <button style="flex:1; background:#6c757d;" onclick="closeNumberingModal()">닫기</button>
            </div>
        </div>
    </div>


    
    <div id="numberingEditorModal" class="modal-overlay">
        <div class="modal-content" style="max-width:860px;">
            <span class="close-btn" onclick="closeNumberingEditorModal()">&times;</span>
            <div class="modal-header">넘버링 편집기 (관리자)</div>
            <p style="margin:0; color:#444; text-align:left;">도면 이미지에서 영역을 드래그한 뒤 단계/문항을 저장하면 학습 모드에 바로 반영됩니다.</p>

            <div class="editor-grid">
                <input id="editorImageUrl" class="editor-wide" placeholder="도면 이미지 경로 (예: ./images/images1.png)">
                <select id="editorStageSelect" onchange="onEditorStageSelectChange()"></select>
                <input id="editorStageTitle" placeholder="단계 제목 (예: MC1 보조접점)">
                <input id="editorComponentId" placeholder="부품 ID (예: MC1)">
                <div id="editorStageWarning" class="editor-warning"></div>
                <select id="editorPinPreset" onchange="onEditorPinPresetChange()">
                    <option value="">부품 프리셋 선택(자동)</option>
                    <option value="FUSE_4">4핀 퓨즈 (상+,상-,하+,하-)</option>
                    <option value="RL_2">2핀 RL (+,-)</option>
                    <option value="WL_2">2핀 WL (+,-)</option>
                    <option value="GL_2">2핀 GL (+,-)</option>
                    <option value="BZ_2">2핀 BZ (+,-)</option>
                    <option value="PB0_2">2핀 PB0 (C,N)</option>
                    <option value="PB1_2">2핀 PB1 (O,N)</option>
                    <option value="SS_3">3핀 SS (M,N,A)</option>
                    <option value="T_8">8핀 타이머(T)</option>
                    <option value="FR_8">8핀 플리커(FR)</option>
                    <option value="X_8">8핀 릴레이(X)</option>
                    <option value="FLS_8">8핀 FLS</option>
                    <option value="EOCR_12">12핀 EOCR</option>
                    <option value="MC1_12">12핀 MC1</option>
                    <option value="MC2_12">12핀 MC2</option>
                </select>
                <select id="editorInputMode">
                    <option value="choice">선택형</option>
                    <option value="input">입력형</option>
                </select>
                <textarea id="editorGuideText" class="editor-wide" rows="2" placeholder="설명 문구"></textarea>
                <input id="editorQuestionLabel" placeholder="문항 라벨 (예: A접점)">
                <input id="editorQuestionAnswer" placeholder="정답 번호 (예: 8)">
                <select id="editorQuestionSelect" class="editor-wide" onchange="onEditorQuestionSelectChange()">
                    <option value="-1">문항 선택 (수정/삭제)</option>
                </select>
                <details class="editor-wide">
                    <summary style="cursor:pointer; font-weight:700; color:#334155;">고급옵션</summary>
                    <div style="margin-top:8px; display:grid; gap:8px;">
                        <div style="display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                            <label style="display:flex; align-items:center; gap:6px; color:#334155; font-weight:600;">
                                <input id="editorAllowReverse" type="checkbox">
                                역순 허용
                            </label>
                            <label style="display:flex; align-items:center; gap:6px; color:#334155; font-weight:600;">
                                채점 방향
                                <select id="editorOrderMode">
                                    <option value="horizontal">가로</option>
                                    <option value="vertical">세로</option>
                                    <option value="both">가로+세로</option>
                                </select>
                            </label>
                        </div>
                        <input id="editorPinDisplayCsv" placeholder="핀 표시 커스텀(쉼표). 상단좌측→하단우측 순서로 입력 (예: 1,2,3,4,C공통,6,+,-공통)">
                        <input id="editorQuestionChoices" placeholder="문항 보기(선택형, 쉼표구분. 예: 6,7,8,9)">
                    </div>
                </details>
            </div>

            <div class="editor-actions">
                <button style="background:#0d6efd;" onclick="startEditorRectMode()">영역 선택 시작</button>
                <button style="background:#6f42c1;" onclick="addEditorQuestion()">문항 추가</button>
                <button style="background:#0ea5e9;" onclick="updateEditorQuestion()">문항 수정</button>
                <button style="background:#ef4444;" onclick="deleteEditorQuestion()">문항 삭제</button>
                <button style="background:#6366f1;" onclick="moveEditorStageUp()">순서 올리기</button>
                <button style="background:#8b5cf6;" onclick="moveEditorStageDown()">순서 내리기</button>
                <button style="background:#17a2b8;" onclick="saveEditorStage()">단계 저장</button>
                <button style="background:#495057;" onclick="newEditorStage()">새 단계</button>
                <button style="background:#dc3545;" onclick="deleteEditorStage()">현재 단계 삭제</button>
                <button style="background:#20c997;" onclick="refreshNumberingFromEditor()">학습 반영</button>
            </div>

            <div class="numbering-editor-canvas-wrap">
                <img id="numberingEditorImage" src="./images/images1.png" alt="넘버링 편집 도면" draggable="false">
                <div id="numberingEditorRect"></div>
            </div>
            <div id="editorRectInfo" style="text-align:left; margin-top:8px; font-size:12px; color:#444;">영역: 미선택</div>

            <div style="display:flex; gap:8px; margin-top:10px;">
                <button style="background:#6f42c1;" onclick="exportNumberingScenario()">JSON 내보내기</button>
                <button style="background:#17a2b8;" onclick="importNumberingScenario()">JSON 불러오기</button>
                <button style="background:#dc3545;" onclick="resetNumberingLocalStorage()">로컬저장 초기화</button>
                <button style="background:#6c757d;" onclick="closeNumberingEditorModal()">닫기</button>
            </div>
            <textarea id="numberingEditorJson" style="width:100%; height:120px; margin-top:8px; font-family:monospace; font-size:12px;"></textarea>
        </div>
    </div>

    <div id="tutorialEditorModal" class="modal-overlay">
        <div class="modal-content" style="max-width:860px;">
            <span class="close-btn" onclick="closeTutorialEditorModal()">&times;</span>
            <div class="modal-header">결선 튜토리얼 편집기 (관리자)</div>
            <p style="margin:0; color:#444; text-align:left;">제목/설명/이미지/페이지 수를 편집합니다. 설명은 HTML을 지원합니다. (`&lt;br&gt;`, `&lt;b&gt;`, `&lt;span style='color:#dc3545;'&gt;`)</p>

            <div class="editor-grid">
                <input id="wiringEditorTitle" class="editor-wide" placeholder="튜토리얼 제목">
                <input id="wiringEditorImage" class="editor-wide" placeholder="튜토리얼 이미지 경로 (예: ./images/images1.png)">
                <div style="display:flex; gap:8px; align-items:center;">
                    <input id="wiringEditorPageCount" type="number" min="1" max="300" value="1" style="width:90px;">
                    <button style="background:#0d6efd;" onclick="applyTutorialPageCount()">페이지 수 적용</button>
                </div>
                <div style="text-align:left; color:#475569; font-size:12px;">페이지별 설명은 아래에서 입력합니다.</div>
            </div>

            <div class="tutorial-editor-toolbar">
                <button onclick="wrapActiveTutorialText('<b>','</b>')">굵게</button>
                <button onclick="insertActiveTutorialText('<br>')">줄바꿈 태그</button>
                <button onclick="wrapActiveTutorialText('<span style=&quot;color:#dc3545;&quot;>','</span>')">빨강</button>
                <button onclick="wrapActiveTutorialText('<span style=&quot;color:#007bff;&quot;>','</span>')">파랑</button>
            </div>

            <div id="wiringEditorPageTabs" class="tutorial-page-tabs"></div>
            <div class="tutorial-page-item">
                <h4 id="wiringEditorActivePageLabel">페이지 1 설명</h4>
                <textarea id="wiringEditorPageText" placeholder="설명(HTML 가능): 줄바꿈(<br>), 굵게(<b>), 색상(<span style='color:#...'>)"></textarea>
            </div>
            <div class="tutorial-page-item">
                <h4>페이지 미리보기</h4>
                <div id="wiringEditorPreview" class="tutorial-preview-box"></div>
            </div>
            <div id="wiringEditorStatus" class="tutorial-editor-status"></div>

            <div class="editor-actions">
                <button style="background:#17a2b8;" onclick="saveTutorialEditor()">저장</button>
                <button style="background:#0d6efd;" onclick="previewTutorialEditor()">미리보기</button>
                <button style="background:#495057;" onclick="addTutorialEditorPage()">새 페이지</button>
                <button style="background:#1f7a8c;" onclick="createNewTutorialLayout()">새 튜토리얼</button>
                <button style="background:#6f42c1;" onclick="exportTutorialScenario()">JSON 내보내기</button>
                <button style="background:#20c997;" onclick="importTutorialScenario()">JSON 불러오기</button>
                <button style="background:#dc3545;" onclick="resetTutorialLocalStorage()">로컬저장 초기화</button>
                <button style="background:#6c757d;" onclick="closeTutorialEditorModal()">닫기</button>
            </div>
            <textarea id="wiringEditorJson" style="width:100%; height:120px; margin-top:8px; font-family:monospace; font-size:12px;"></textarea>
        </div>
    </div>

    <h2>전기기능사 마스터</h2>
    
    <div class="controls">
        <select id="layoutSelect" onchange="changeLayout()"></select>
        <button class="btn-info" onclick="openModal()">📖 설명</button>
        <button id="btnNumbering" class="btn-numbering" onclick="toggleNumberingMode()">넘버링</button>
        <button class="btn-undo" onclick="undoLastAction()">↩ (Ctrl+Z)</button>
        <button class="btn-reset" onclick="resetWires()">초기화</button>
        <button id="btnCheck" class="btn-check" onclick="toggleGrading()">채점 하기</button>
        <div style="width: 1px; height: 20px; background: #666; margin: 0 5px;"></div>
        <button class="btn-admin" onclick="toggleAdminMode()">🔧 관리자</button>
    </div>

    <div id="adminInfo">
        <div class="info-header">
            <span style="color:#00ffff;"><b>[관리자: <span id="currentLayoutNum">1</span>번]</b></span>
            <div>
                <button class="btn-delete-all" onclick="clearCurrentLayoutData()">🗑️ 삭제</button>
            </div>
        </div>
        <div style="margin-top: 6px; color:#b8d4ff; font-size: 13px; line-height: 1.5;">
            관리자 결선을 저장하면 연결 노드(핀 집합) 기준으로 채점합니다.<br>
            결선 순서/경로가 달라도 전기적으로 같은 노드면 정답 처리됩니다.
        </div>
        <div class="component-filter-panel">
            <div style="display:flex; gap:8px; align-items:center; justify-content:space-between;">
                <b style="color:#93c5fd;">부품 세팅 (현재 도면)</b>
                <button style="background:#475569; padding:6px 10px; font-size:12px;" onclick="toggleComponentFilterPanel()">열기/닫기</button>
            </div>
            <div id="componentFilterWrap" style="display:none;">
                <div id="componentFilterList" class="component-filter-list"></div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:8px;">
                    <button style="background:#0ea5e9;" onclick="selectAllComponentFilter()">전체 선택</button>
                    <button style="background:#64748b;" onclick="clearAllComponentFilter()">전체 해제</button>
                </div>
                <div style="display:grid; grid-template-columns: 1fr 1fr; gap:8px; margin-top:8px;">
                    <button style="background:#22c55e;" onclick="applyComponentFilterForCurrentLayout()">세팅 적용</button>
                    <button style="background:#ef4444;" onclick="resetComponentFilterForCurrentLayout()">기본값 복원</button>
                </div>
            </div>
        </div>
        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button style="background:#4ecdc4; color:#111;" onclick="saveNodeAnswersFromWires()">입력 완료 저장</button>
            <button style="background:#6c757d;" onclick="removeLastSavedAnswer()">최근 저장 취소</button>
        </div>
        <div style="margin-top: 8px; display:grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button style="background:#fd7e14;" onclick="saveTutorialFlowFromWires()">재생 순서 저장</button>
            <button style="background:#6b7280;" onclick="clearTutorialFlow()">재생 순서 초기화</button>
        </div>
        <div style="margin-top: 8px; display:grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button style="background:#6f42c1;" onclick="openNumberingEditorModal()">넘버링 편집기</button>
            <button style="background:#0ea5e9;" onclick="openTutorialEditorModal()">결선 튜토리얼 편집기</button>
        </div>
        <div style="margin-top: 10px; padding-top:10px; border-top: 1px solid #444;">
             <button style="width:100%; background:#444;" onclick="exportAllData()">📋 전체 데이터 생성</button>
        </div>
        <div style="margin-top: 8px; display:grid; grid-template-columns: 1fr 1fr; gap: 8px;">
            <button style="background:#0d6efd;" onclick="downloadAnswerJsonFile()">정답 JSON 다운로드</button>
            <button style="background:#198754;" onclick="triggerAnswerJsonImport()">정답 JSON 불러오기</button>
        </div>
        <input id="answerJsonInput" type="file" accept=".json,.js,application/json,text/javascript" onchange="handleAnswerJsonFileChange(event)" style="display:none;">
        <textarea id="exportArea" readonly></textarea>
        <div id="saveStatus" style="color: yellow; margin-top: 5px; height: 20px;"></div>
    </div>

    <div class="legend">
        <span><i class="dot" style="background:#e6b800"></i>작업선</span>
        <span><i class="dot" style="background:#28a745"></i>정답</span>
        <span><i class="dot" style="background:#dc3545"></i>오답</span>
    </div>
    <span id="statusMsg">대기 중</span>
    
    <canvas id="simCanvas" width="700" height="720"></canvas>
    <div id="playbackControls">
        <div class="row">
            <button onclick="pauseTutorialFlowPlayback()">일시정지</button>
            <button onclick="resumeTutorialFlowPlayback()">재개</button>
            <button onclick="stepTutorialFlowPlayback()">스텝</button>
            <button onclick="stopTutorialFlowPlayback()">중지</button>
            <span id="playbackProgress" style="font-size:12px; color:#93c5fd;">재생 대기</span>
        </div>
    </div>

<script src="./src/data/local-overrides.js"></script>
<script src="./src/data/repository.js"></script>
<script src="./src/ui/modal.js"></script>
<script src="./src/sim/canvas.js"></script>
<script src="./src/sim/wiring-engine.js"></script>
</body>
</html>








